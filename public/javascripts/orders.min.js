let orders={selectedOrder:void 0,initialise:(void 0,async()=>{let e;try{e=await orders.fetchOrders()}catch(e){return}orders.populateOrders(e),dashboard.processOrders(e)}),errorHandler:(void 0,e=>{}),formatDate:(void 0,e=>`${moment(e).format("DD")} ${moment(e).format("MMM")} ${moment(e).format("YYYY")}`),selectOrder:(void 0,e=>orders.selectedOrder===e?orders.deselectOrder(orders.selectedOrder):(orders.selectedOrder&&orders.deselectOrder(orders.selectedOrder),document.querySelector("#order-summary-"+e).classList.add("active-item"),document.querySelector("#order-detail-"+e).classList.remove("hide"),orders.selectedOrder=e)),deselectOrder:(void 0,e=>{document.querySelector("#order-summary-"+e).classList.remove("active-item"),document.querySelector("#order-detail-"+e).classList.add("hide"),orders.selectedOrder=void 0}),fetchOrders:(void 0,()=>new Promise(async(e,t)=>{let r;try{r=(await axios.get("/orders/fetch-orders")).data}catch(e){r={status:"error",content:e}}return"error"===r.status?(orders.errorHandler(r.content),t()):"failed"===r.status?t():e(r.content)})),populateOrders:(void 0,(e=[])=>{if(e.length)for(let t=0;t<e.length;t++){const r=e[t];orders.addOrder(r)}}),addOrder:(void 0,e=>{orders.addSummary(e),orders.addDetailed(e);for(let t=0;t<e.makes.checkout.length;t++){const r=e.makes.checkout[t];orders.addMake(e,r)}for(let t=0;t<e.comments.length;t++){const r=e.comments[t];orders.addComment(e,r)}}),addSummary:(void 0,e=>{const t=`<div class="order-title-container">${`<p class="order-name">Order #${e.number}</p>`+`<div id="order-summary-notification-${e._id}"></div>`}</div>`;let r;switch(e.status){case"checkedout":r="Validating Payment";break;case"validated":r="Building Order";break;case"built":r="Packaging Order";break;case"reviewed":r="Order Reviewed";break;case"completed":r="Order Completed";break;case"cancelled":r="Refunding Order";break;case"refunded":r="Order Refunded";break;default:break}if("pickup"===e.shipping.method)switch(e.status){case"shipped":r="Ready for Pickup";break;case"arrived":r="Package Picked Up";break;default:break}else switch(e.status){case"shipped":r="Package Shipped";break;case"arrived":r="Package Arrived";break;default:break}const a=`\n  <div class="transit-container order-info">\n    <i class="fas fa-truck"></i>\n    <p class="order-info-text">${r}</p>\n  </div>\n  `,i=`\n  <div class="payment-container order-info">\n    <i class="fa fa-calendar-o"></i>\n    <p class="order-info-text">${orders.formatDate(e.date[e.status])}</p>\n  </div>\n  `;let n;switch(e.shipping.address.option){case"new":n=`${e.shipping.address.new.city}, ${e.shipping.address.new.country}`;break;case"saved":n=`${e.shipping.address.saved.city}, ${e.shipping.address.saved.country}`;break;default:break}const d=`\n  <div id="order-content-container">\n    <div class="order-info-wrap">${a+i+`\n  <div class="location-container order-info">\n    <i class="fas fa-map-marker-alt"></i>\n    <p class="order-info-text">${n}</p>\n  </div>\n  `}</div>\n    <div class="order-total"><p class="total-title">Total</p>${`<p class="order-total">$${global.priceFormatter(e.payment.amount.total.total)}</p>`}</div>\n  </div>\n  `,s=`\n  <div id="order-summary-${e._id}" class="order-item"\n    onclick="orders.selectOrder('${e._id}')">\n      ${t+d}\n      <div class="active-div"></div>\n  </div>\n  `;document.querySelector("#order-container").insertAdjacentHTML("beforeend",s)}),addDetailed:(void 0,e=>{const t='<div class="divider-container"><div class="divider"></div></div>',r=orders.createTracking(e),a=orders.createSummary(e),i=orders.createPreview(e),n=orders.createComments(e),d=`\n  <div id="order-detail-${e._id}" class="order-detail-wrap hide">\n    <p class="orderdetails" id="order-details-title">Order Details</p>\n    <div class="order-detail-container">\n      <div class="exit-icon" onclick="orders.deselectOrder('${e._id}');">\n        <img src="/public/images/user-x.png" alt="X">\n      </div>\n      ${r+t+a+t+i+t+n}\n    </div>\n  </div>\n  `;document.querySelector("#orders-area").insertAdjacentHTML("beforeend",d)}),createTracking:(void 0,e=>{const t=`<p id="order-details-name">Order #${e.number}</p>`;let r,a,i,n,d,s;switch("pickup"===e.shipping.method?(d="Ready for Pickup",s="Package Picked up"):(d="Package Shipped",s="Packaged Arrived"),e.status){case"checkedout":[r,a,i,n]=orders.generateCheckedout(e,d,s);break;case"validated":[r,a,i,n]=orders.generateValidated(e,d,s);break;case"built":[r,a,i,n]=orders.generateBuilt(e,d,s);break;case"shipped":[r,a,i,n]=orders.generateShipped(e,d,s);break;case"arrived":[r,a,i,n]=orders.generateArrived(e,d,s);break;case"reviewed":[r,a,i,n]=orders.generateReviewed(e,d,s);break;case"completed":[r,a,i,n]=orders.generateCompleted(e,d,s);break;case"cancelled":r="Refunding order",a="We are not processing your refund.";break;case"refunded":r="Order refunded",a="Refunds have been processed. Your order is no longer active.";break;default:break}return`\n  <div class="order-tracking-container">${t+i+n+`\n  <div class="status-detail-container">\n    <p class="status-detail-title">Tracking Details</p>\n    <div class="status-container"><p class="status-text">${r}</p></div>\n    <div class="status-description-container"><p class="status-description">${a}</p></div>\n  </div>\n  `}</div>\n  `}),createStatusProgress:(void 0,(e=[],t=[],r=[])=>{let a='<div class="progress-bar-container">';for(let i=0;i<e.length;i++){const n=e[i],d=t[i],s=r[i];"completed"===n?(a+=`\n      <div class="progress-container ${d}">\n        <div class="status-circle"></div>\n        <div class="status-line"></div>\n      </div>\n      `,i!==e.length-1&&(a+=`\n        <div class="progress-bar ${s}"></div>\n        `)):"on-progress"===n?(a+=`\n      <div class="progress-container ${d}">\n        <div class="status-circle status-circle-current">\n          <div class="status-circle-current-inner"></div>\n        </div>\n        <div class="status-line ${s}"></div>\n      </div>\n      `,i!==e.length-1&&(a+='\n        <div class="progress-bar next-progress"></div>\n        ')):"incomplete"===n&&(a+=`\n      <div class="progress-container ${d}">\n        <div class="status-circle next-circle"></div>\n        <div class="status-line"></div>\n      </div>\n      `,i!==e.length-1&&(a+=`\n        <div class="progress-bar next-progress ${s}"></div>\n        `))}return a+="</div>",a}),createStatusLabel:(void 0,(e=[],t=[])=>{let r='<div class="progress-caption-container">';for(let a=0;a<e.length;a++){const i=e[a];r+=`\n    <div class="status-label-container ${t[a]}">\n      <p class="status-label">${i}</p>\n    </div>\n    `}return r+="</div>",r}),createSummary:(void 0,e=>{let t,r;switch(e.status){case"checkedout":t="Validating Payment";break;case"validated":t="Building Order";break;case"built":t="Packaging Order";break;case"reviewed":t="Order Reviewed";break;case"completed":t="Order Completed";break;case"cancelled":t="Refunding Order";break;case"refunded":t="Order Refunded";break;default:break}if("pickup"===e.shipping.method)switch(e.status){case"shipped":t="Ready for Pickup";break;case"arrived":t="Package Picked Up";break;default:break}else switch(e.status){case"shipped":t="Package Shipped";break;case"arrived":t="Package Arrived";break;default:break}switch(e.shipping.address.option){case"new":r=`${e.shipping.address.new.city}, ${e.shipping.address.new.country}`;break;case"saved":r=`${e.shipping.address.saved.city}, ${e.shipping.address.saved.country}`;break;default:break}const a=`\n  <div class="order-info-wrap">\n    <div class="transit-container order-info">\n      <i class="fas fa-truck"></i>\n      <p class="order-info-text">${t}</p>\n    </div>\n    <div class="payment-container order-info">\n      <i class="fa fa-calendar-o"></i>\n      <p class="order-info-text">${orders.formatDate(e.date[e.status])}</p>\n    </div>\n    <div class="location-container order-info">\n      <i class="fas fa-map-marker-alt"></i>\n      <p class="order-info-text">${r}</p>\n    </div>\n    <div class="change-location">Change location</div>\n  </div>\n  `,i=`\n  <div id="order-makes-${e._id}" class="order-item-list-container"></div>\n  `,n=e.payment.amount.makes.total+e.payment.amount.manufacturing.total,d=e.payment.amount.discount.total,s=e.payment.amount.discount.rate,o=e.payment.amount.gst.total,c=e.payment.amount.shipping.total,l=e.payment.amount.total.total;return`\n  <div class="order-summary">\n    <p class="order-summary-title">Order Summary</p>\n    <div class="order-detail-content-container">\n      ${a+i+`\n  <div class="price-breakdown-container">\n    <div class="divider-container">\n      <div class="divider-subtotal"></div>\n    </div>\n    <div class="price-breakdown">\n      <div class="subtotal-container">\n        <div class="subtotal-title">Sub-total</div>\n        <div class="subtotal-price">$${global.priceFormatter(n)}</div>\n      </div>\n      <div class="subtotal-container">\n        <div class="subtotal-title">Discount</div>\n        <div class="subtotal-price"><span>(${100*s}%)</span> -$${global.priceFormatter(d)}</div>\n      </div>\n      <div class="subtotal-container">\n        <div class="subtotal-title">GST</div>\n        <div class="subtotal-price">$${global.priceFormatter(o)}</div>\n      </div>\n      <div class="subtotal-container">\n        <div class="subtotal-title">Shipping</div>\n        <div class="subtotal-price">$${global.priceFormatter(c)}</div>\n      </div>\n      <div class="divider-container2">\n        <div class="divider-subtotal totalprice"></div>\n      </div>\n      <div class="order-detail-total">\n        <p class="subtotal-title">Total</p>\n        <p class="detail-order-total">$${global.priceFormatter(l)}</p>\n      </div>\n    </div>\n  </div>\n  `}\n    </div>\n  </div>\n  `}),createPreview:(void 0,e=>`\n  <div class="order-preview">\n    <p class="preview-title">Preview</p>\n    <div id="order-preview-${e._id}" class="preview-photo-container"></div>\n  </div>\n  `),createComments:(void 0,e=>{const t=JSON.stringify(e),r=`\n  <div class="comment-form-container">\n      <button id="attach-comment" class="submit-comment-container rmv-btn-css" onclick=''>\n      <?xml version="1.0" encoding="iso-8859-1"?>\n      <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"\n        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 471.641 471.641"\n        style="enable-background:new 0 0 471.641 471.641;" xml:space="preserve">\n        <g>\n          <path d="M431.666,49.412c-51.692-50.578-134.33-50.567-186.009,0.025L28.911,266.184c-39.192,40.116-38.443,104.407,1.673,143.599\n          c39.456,38.548,102.47,38.548,141.926,0l196.267-196.267c25.515-25.515,25.515-66.884,0-92.399\n          c-25.515-25.515-66.884-25.515-92.399,0L88.644,308.85c-6.548,6.78-6.36,17.584,0.42,24.132c6.614,6.388,17.099,6.388,23.713,0\n          L300.51,145.249c12.449-11.926,32.209-11.501,44.134,0.948c11.565,12.073,11.565,31.114,0,43.187L148.378,385.65\n          c-26.514,26.137-69.197,25.831-95.334-0.683c-25.873-26.246-25.873-68.405,0-94.651L269.79,73.569\n          c38.608-38.622,101.214-38.633,139.836-0.026c38.622,38.607,38.633,101.214,0.026,139.836L192.905,430.126\n          c-7.159,6.131-7.993,16.905-1.862,24.064c6.131,7.159,16.905,7.993,24.064,1.862c0.668-0.572,1.29-1.194,1.862-1.862\n          l216.747-216.747C485.073,184.954,484.156,100.769,431.666,49.412z" />\n        </g>\n      </svg>\n    </button>\n    <input type="text" class="messageSubmit" id="order-comment-${e._id}" placeholder="Post a comment...">\n    <button id="post-comment-${e._id}" class="submit-comment-container rmv-btn-css" onclick='orders.postComment(${t});'>\n      <?xml version="1.0" encoding="iso-8859-1"?>\n      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n      viewBox="0 0 500 500" style="enable-background:new 0 0 500 500;" xml:space="preserve">\n      <style type="text/css">\n        .st0{fill:#FFFFFF;}\n      </style>\n      <g id="Layer_1">\n      </g>\n      <g id="Layer_2">\n        <polygon class="st0" points="6.6,34.2 497.3,247.8 7,459.7 7,296 360.1,246.9 7.4,200.3 \t"/>\n      </g>\n      </svg>\n    </button>\n  </div>\n  `;return`\n  <div class="comment-wrap">\n    <p class="comment-title">Comments</p>\n    <div id="order-comments-${e._id}" class="comment-container"></div>\n    ${r}\n  </div>\n  `}),formatMakeName:(void 0,(e="")=>{const t=e.split("."),r=t.slice(0,t.length-1).join(),a=r.length;let i={first:void 0,middle:void 0,last:void 0};return i=a>12?{first:r.slice(0,4),middle:" ... ",last:r.slice(a-4)}:{first:r,middle:"",last:""},i.first+i.middle+i.last}),addMake:(void 0,(e,t)=>{const r=`\n  <div class="order-item-detailed">\n    <div id="order-make-viewer-${t.id}" class="item-img-container"></div>\n    <div class="item-name-container">${orders.formatMakeName(t.file.name)}</div>\n    <div class="item-type-list-container">\n      ${t.material}, ${t.quality}, ${t.strength}, ${t.colour}\n    </div>\n    <div class="item-quantity-container">\n      <p class="qty-title">Qty</p>\n      <div class="order-item-quantity">${t.quantity.built}/${t.quantity.ordered}</div>\n    </div>\n    <div class="order-item-price">$${global.priceFormatter(t.quantity.ordered*t.price)}</div>\n  </div>\n  `;document.querySelector("#order-makes-"+e._id).insertAdjacentHTML("beforeend",r),orders.viewerFetch("/files/stl/fetch/"+t.file.id,"order-make-viewer-"+t.id),t.comment&&orders.addComment(e,t.comment)}),generateCheckedout:(void 0,(e={},t,r)=>["Validating payment","We are currently validating your payment. Thank you for your patience.",orders.createStatusProgress(["on-progress","incomplete","incomplete","incomplete","incomplete"],["","","","full-tracking","full-tracking"],["","","full-tracking","full-tracking",""]),orders.createStatusLabel(["Validating Payment","Building Order","Packaging Order",t,r],["","","","full-tracking","full-tracking"])]),generateValidated:(void 0,(e={},t,r)=>{const a=orders.createStatusProgress(["completed","on-progress","incomplete","incomplete","incomplete"],["","","","full-tracking","full-tracking"],["","","full-tracking","full-tracking",""]),i=orders.createStatusLabel(["Validating Payment","Building Order","Packaging Order",t,r],["","","","full-tracking","full-tracking"]);let n,d;if("normal"===e.manufacturingSpeed)d=3;else if("urgent"===e.manufacturingSpeed)d=1;else{}const s=moment(e.date.validated).add(d,"days"),o=moment(),c={days:s.diff(o,"days",!0),hours:s.diff(o,"hours",!0),minutes:s.diff(o,"minutes",!0)};if(c.minutes<0)n="We are prioritising the completion of your order";else if(Math.floor(c.days)>0){const e=Math.round(c.days);n=e>1?`The estimated time to completion is ${e} days`:`The estimated time to completion is ${e} day`}else if(Math.floor(c.hours)>0){const e=Math.round(c.hours);n=e>1?`The estimated time to completion is ${e} hours`:`The estimated time to completion is ${e} hour`}else{const e=Math.round(c.minutes);n=e>1?`The estimated time to completion is ${e} minutes`:1==e?"The estimated time to completion is 1 minute":"The estimated time to completion is less than a minute"}return["Building order",`We are currently building your order. ${n}. Thank you for your patience.`,a,i]}),generateBuilt:(void 0,(e={},t,r)=>{let a,i="We are currently packaging your order. ";const n=global.nextWorkingDay(e.date.built),d=moment(n).format("ddd, DD MMM YYYY");"pickup"===e.shipping.method?(a="Packaging order",i+=`It will be ready for pickup next working day (${d}). `):(a="Packaging order",i+=`It will be sent for shipping next working day (${d}). `),i+="Thank you for your patience.";return[a,i,orders.createStatusProgress(["completed","completed","on-progress","incomplete","incomplete"],["full-tracking","","","","full-tracking"],["full-tracking","","","full-tracking",""]),orders.createStatusLabel(["Validating Payment","Building Order","Packaging Order",t,r],["full-tracking","","","","full-tracking"])]}),generateShipped:(void 0,(e={},t,r)=>{let a,i;if("pickup"===e.shipping.method)a="Ready for pickup",i="You can now pickup your package. Pick it up at 16 Dapple Place, Flat Bush, Auckland, 2019, New Zealand";else{let t;"tracked"===e.shipping.method?t=3:"courier"===e.shipping.method&&(t=1);const r=global.calculateWorkingDay(e.date.shipped);a="Package shipped",i=`Your package is now on its way to your doorstep. Its estimated arrival date is ${moment(r).format("ddd, DD MMM YYYY")}. Track your order <a href="https://www.nzpost.co.nz/tools/tracking/item/${e.shipping.tracking}">here</a>.`}return[a,i,orders.createStatusProgress(["completed","completed","on-progress","incomplete","incomplete"],["full-tracking","","","","full-tracking"],["full-tracking","","","full-tracking",""]),orders.createStatusLabel(["Validating Payment","Building Order",t,r,"Order Reviewed"],["full-tracking","","","","full-tracking"])]}),generateArrived:(void 0,(e={},t,r)=>{let a,i;"pickup"===e.shipping.method?(a="Package picked up",i="You have now picked up your package. Thank you for using CreateBase. Please leave us a review."):(a="Packaged arrived",i="Your package has arrived to your doorstep. Thank you for using CreateBase. Please leave us a review.");return[a,i,orders.createStatusProgress(["completed","completed","on-progress","incomplete","incomplete"],["full-tracking","","","","full-tracking"],["full-tracking","","","full-tracking",""]),orders.createStatusLabel(["Validating Payment",t,r,"Order Reviewed","Order Completed"],["full-tracking","","","","full-tracking"])]}),generateReviewed:(void 0,(e={},t,r)=>["Order reviewed","Thank you for leaving us a review.",orders.createStatusProgress(["completed","completed","completed","on-progress","incomplete"],["full-tracking","full-tracking","","",""],["full-tracking","full-tracking","","",""]),orders.createStatusLabel(["Validating Payment",t,r,"Order Reviewed","Order Completed"],["full-tracking","full-tracking","","",""])]),generateCompleted:(void 0,(e={},t,r)=>["Order completed","Your order has been completed. Thank you for using CreateBase.",orders.createStatusProgress(["completed","completed","completed","completed","on-progress"],["full-tracking","full-tracking","","",""],["full-tracking","full-tracking","","",""]),orders.createStatusLabel(["Validating Payment",t,r,"Order Reviewed","Order Completed"],["full-tracking","full-tracking","","",""])]),addComment:(void 0,(e,t)=>{let r;r=e.accountId+""==t.author.id+""?"admin-comment":"customer-comment";const a=`\n  <div class="${r}">\n    <div class="profile-pic-container">\n      <img decoding="async" src="/file/display-picture/${t.author.picture}">\n    </div>\n    <div class="message">\n      <div class="msg-date-container">${orders.formatDateComment(t.date.modified)}</div>\n      <div class="msg-container">${t.message}</div>\n    </div>\n  </div>\n  `;document.querySelector("#order-comments-"+e._id).insertAdjacentHTML("beforeend",a)}),postComment:(void 0,async e=>{document.querySelector("#post-comment-"+e._id).setAttribute("disabled","");const t=orders.collectComment(e._id);let r;try{r=await orders.submitComment(t)}catch(e){return orders.errorHandler(e)}"failed"!==r.status&&(orders.addComment(e,r.content),document.querySelector("#post-comment-"+e._id).removeAttribute("disabled"),document.querySelector("#order-comment-"+e._id).value="")}),collectComment:(void 0,e=>({orderId:e,message:document.querySelector("#order-comment-"+e).value})),submitComment:(void 0,e=>new Promise(async(t,r)=>{let a;try{a=(await axios.post("/orders/post-comment",e)).data}catch(e){return r(e)}return"error"===a.status?r(a.content):t(a)})),formatDateComment:(void 0,e=>`${moment(e).format("hh")}:${moment(e).format("mm")}${moment(e).format("a")} ${moment(e).format("DD")} ${moment(e).format("MMM")} ${moment(e).format("YYYY")}`),viewerFetch:(void 0,async(e,t)=>{var r=document.getElementById(t);let a=.02*(document.documentElement.clientHeight>document.documentElement.clientWidth?document.documentElement.clientHeight:document.documentElement.clientWidth)+20;var i=new THREE.PerspectiveCamera(70,a/a,1,1e3),n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});n.setSize(a,a),r.appendChild(n.domElement),r.addEventListener("resize",(function(){let e=.02*(document.documentElement.clientHeight>document.documentElement.clientWidth?document.documentElement.clientHeight:document.documentElement.clientWidth)+20;n.setSize(e,e),i.aspect=e/e,i.updateProjectionMatrix()}),!1);var d=new THREE.Scene;d.add(new THREE.HemisphereLight(16777215,7895160,.8));(new THREE.STLLoader).load(e,e=>{orders.viewerProcess(i,n,d,e)})}),viewerProcess:(void 0,(e,t,r,a)=>{var i=new THREE.MeshPhongMaterial({color:15790320,specular:16316664,shininess:0,reflectivity:0}),n=new THREE.Mesh(a,i);r.add(n);var d=new THREE.Vector3;a.computeBoundingBox(),a.boundingBox.getCenter(d),n.geometry.applyMatrix4((new THREE.Matrix4).makeTranslation(-d.x,-d.y,-d.z)),n.geometry.rotateY(-Math.PI/5);var s=Math.max(a.boundingBox.max.x,a.boundingBox.max.y,a.boundingBox.max.z);e.position.z=2.5*s;var o=function(){requestAnimationFrame(o),t.render(r,e)};o()})};